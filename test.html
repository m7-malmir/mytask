<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>رزرو غذا (جدید)</title>
  <style>
    body { font-family: Tahoma, Vazirmatn, Arial; background: #fdf7ff; direction: rtl; }
    table { width: 100%; max-width:600px; margin:30px auto; border-collapse: separate; border-spacing:0 10px; }
    th, td { text-align: center; padding: 13px 6px; font-size: 1.08em; }
    th { background: #f4e4ff; color:#8246be; font-weight:700; border-radius:6px 6px 0 0; }
    td { border-radius: 5px; }
    .meal-label { cursor:pointer; display:block; border-radius:7px; transition: .20s; padding:10px 0; position:relative; background:#fff; font-weight:500; }
    .meal-label input[type=radio] { display:none; }
    .meal-label.selected { background:#a452cf; color:#fff; font-weight:700; }
    .meal-label.unavailable { opacity:.45; background:#ece9f8; color:#aaa; pointer-events: none; }
    .date-col { font-weight:600; color:#593882; }
    #submit-btn { background:#8246be; color:#fff; border:none; border-radius:6px; font-size:1.09em; padding:9px 40px; margin:35px auto 0; display:block; cursor:pointer; transition:.1s; font-weight:700; }
    #submit-btn:active { background:#673399; }
    #result-items { background:#F5F0FB; direction: rtl; max-width:600px; margin:24px auto 0; border-radius:9px; font-family:inherit; padding:16px; color:#4a2972; font-size:1.03em;}
  </style>
</head>
<body>
  <form id="reserve-form">
    <table>
      <thead>
        <tr>
          <th>تاریخ</th>
          <th>غذای ۱</th>
          <th>غذای ۲</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="date-col">۳۰ تیر</td>
          <td>
            <label class="meal-label" data-day="0" data-val="101">
              <input type="radio" name="meal-0" value="101"> قورمه سبزی
            </label>
          </td>
          <td>
            <label class="meal-label" data-day="0" data-val="102">
              <input type="radio" name="meal-0" value="102"> جوجه کباب
            </label>
          </td>
        </tr>
        <tr>
          <td class="date-col">۳۱ تیر</td>
          <td>
            <label class="meal-label" data-day="1" data-val="201">
              <input type="radio" name="meal-1" value="201"> عدس‌پلو
            </label>
          </td>
          <td>
            <label class="meal-label unavailable">
              <input type="radio" disabled> ناموجود
            </label>
          </td>
        </tr>
        <tr>
          <td class="date-col">۱ مرداد</td>
          <td>
            <label class="meal-label" data-day="2" data-val="301">
              <input type="radio" name="meal-2" value="301"> کباب کوبیده
            </label>
          </td>
          <td>
            <label class="meal-label" data-day="2" data-val="302">
              <input type="radio" name="meal-2" value="302"> زرشک پلو
            </label>
          </td>
        </tr>
        <tr>
          <td class="date-col">۲ مرداد</td>
          <td>
            <label class="meal-label" data-day="3" data-val="401">
              <input type="radio" name="meal-3" value="401"> کوکو سبزی
            </label>
          </td>
          <td>
            <label class="meal-label" data-day="3" data-val="402">
              <input type="radio" name="meal-3" value="402"> مرغ
            </label>
          </td>
        </tr>
        <!-- ... بقیه روزها همین شکلی ... -->
      </tbody>
    </table>
    <button id="submit-btn" type="submit">ثبت انتخاب‌ها</button>
    <div id="result-items"></div>
  </form>
  <script>
      // اکتیو و بنفش کردن فقط یکی برای هر روز (گروه radio)
      document.querySelectorAll('.meal-label input[type=radio]').forEach(function(radio) {
          radio.addEventListener('change', function() {
              const name = this.name;
              document.querySelectorAll('input[name="'+name+'"]').forEach(function(r){
                  r.parentElement.classList.remove('selected');
              });
              this.parentElement.classList.add('selected');
          });
      });

      // پیشفرض انتخاب اگر فقط یک گزینه
      document.querySelectorAll('tr').forEach(function(tr){
          const actives = tr.querySelectorAll('.meal-label:not(.unavailable) input[type=radio]');
          if (actives.length == 1) {
              actives[0].checked = true;
              actives[0].parentElement.classList.add('selected');
          }
      });

      // کلیک روی لیبل باعث تیک شدن radio میشه
      document.querySelectorAll('.meal-label:not(.unavailable)').forEach(function(lbl){
        lbl.addEventListener('click',function(e){ 
          this.querySelector('input').checked = true; 
          this.querySelector('input').dispatchEvent(new Event('change'));
        });
      });

      // دکمه ثبت انتخاب‌ها - مقدار هر ردیف (id غذای انتخاب شده) رو میده
      document.getElementById('reserve-form').addEventListener('submit',function(e){
          e.preventDefault();
          let result = [];
          document.querySelectorAll('tr').forEach(function(tr,i){
              const selected = tr.querySelector('.meal-label.selected input[type=radio]');
              if(selected){
                  result.push({
                      day: i+1,
                      id: selected.value,
                      label: selected.parentElement.innerText.trim()
                  });
              }
          });
          // نمایش انتخاب‌ها جهت تست
          let out = result.map(row=>`روز ${row.day}: #${row.id} (${row.label})`).join('<br>');
          document.getElementById('result-items').innerHTML = out || 'هیچ غذایی انتخاب نشد!';
          // اینجا میتونی result رو ajax یا fetch به سمت سرور بفرستی (id ها رو داری)
          // console.log(result)
      });
  </script>
</body>
</html>











// Create a variable to hold our form module
var $form;

$(function () {
    $form = (function () {
        // ==================== Init =====================
        function init() {
            build();
        }

        // ==================== Build ====================
        function build() {
			// Set specific styling
			$("body").css({overflow: "hidden"}).attr({scroll: "no"});
				
			// Set the new dialog title
			//changeDialogTitle("قراردادهای ترید مارکتینگ و C&S");
        }

        // ==================== Return ====================
        return {
            init: init
        };
    })();

    // Call the init functio
    $form.init();
});






























						FormManager.readEntityFoodReservationّ(,
							function(list,status) {
                  
              }
            );



$('#cmbCostRequestTypeId').prepend('<option value="">انتخاب کنید</option>');
$('#cmbCostRequestTypeDetailId').prepend('<option value="">انتخاب کنید</option>');
$('#cmbCostRequestTypeSubDetail').prepend('<option value="">انتخاب کنید</option>');



انتخاب نوع و جزییات و ریز هزینه 

dpCostDate->
----------
1cmbCostRequestTypeId->
2cmbCostRequestTypeDetailId->
3cmbCostRequestTypeSubDetail->

------------------
cmbOriginProvinceId
cmbOriginCityId
dpStartDate
txtStartKM  txtEndKM
cmbDestinationProvinceId
cmbDestinationCityId
bpEndDate

------------------
txtRequestCostPrice->
txtDiscription->








$("#btnRegister").click(function() {

    // تابع تولید شماره جدید
    function getNextCostRequestNo(list) {
        const startNum = 100001;
        if (!Array.isArray(list) || list.length === 0) {
            return "CR" + startNum;
        }
        let maxNum = startNum - 1;
        list.forEach(item => {
            let value = item.CostRequestNo;
            let num = 0;
            if (typeof value === "string" && value.startsWith("CR")) {
                num = parseInt(value.replace("CR", ""), 10);
            } else {
                num = parseInt(value, 10);
            }
            if (!isNaN(num) && num > maxNum) {
                maxNum = num;
            }
        });
        const nextNum = maxNum + 1;
        return "CR" + nextNum.toString().padStart(6, "0");
    }
    
    // کنترل خالی بودن عنوان
    let requestTitle = $('#txtRequestTitle').val().trim();
    if (requestTitle == "") {
        $.alert("لطفا عنوان پرونده هزینه را وارد کنید", "توجه", "rtl");
        return;
    }
    
    // خواندن لیست و ثبت رکورد جدید
    FormManager.readCostRequest({}, function(list, status) {
        let nextCR = getNextCostRequestNo(list);   // ساختن شماره جدید
        let insertParams = {
            CostRequestNo: nextCR,
            CreatorUserId: currentUserId,
            CostRequestTitle: requestTitle  // تایپو تصحیح شد

        };
        FormManager.insertCostRequest(insertParams,
            function(dataXml) {
                myHideLoading();

                let pk = dataXml.find("row:first").find(">col[name='" + primaryKeyName + "']").text();
                $("#lblCostRequestID").text(pk);

                $.alert(
                    `درخواست شما با موفقیت ذخیره شد`,
                    "ذخیره شد",
                    "rtl"
                );
                $('#btnRegister').prop('disabled', true);
                $("#txtCostRequestNo").val(nextCR);
            },
            function(err) {
                myHideLoading();
                alert(err);
            }
        );
    });
});






//////////////////////////////////////////////////////
let $form;
let CurrentUserId;
var globalCostRequestID = null;

$(function () {
    $form = (function () {
        var inEditMode = false,
            primaryKeyName = "Id";

        // ======== Helpers =====
        // اضافه کردن گزینه "انتخاب کنید" اگر وجود نداشت
        function addPlaceholder($sel) {
            if (
                $sel.length &&
                (!($sel.find("option:first").text().trim() === "انتخاب کنید") || $sel.find("option:first").val() !== "")
            ) {
                $sel.prepend('<option value="" selected disabled hidden>انتخاب کنید</option>');
                $sel[0].selectedIndex = 0;
            }
        }

        // فعال کردن MutationObserver برای هر سلکتور
        function observeAndAddPlaceholder(selector) {
            var $sel = $(selector);
            if (!$sel.length) return;
            var observer = new MutationObserver(function () {
                if ($sel.find("option").length > 0) {
                    addPlaceholder($sel);
                    observer.disconnect();
                }
            });
            observer.observe($sel[0], { childList: true });
        }

        // ======== Init ========
        function init() {
            build();
            createControls();
        }

        // ======== Build =======
        function build() {
            params = window.dialogArguments || window.arguments;
				$(document).ready(function() {
			    globalCostRequestID = params.costRequestID;
			});

            changeDialogTitle("ثبت جزییات اعلام هزینه");
        }

        // ===== CreateControls ====
        function createControls() {
            // لیست همه سلکتورهایی که نیاز به placeholder دارن
            var selectIds = [
                "#cmbCostRequestTypeId",
                "#cmbCostRequestTypeDetailId",
                "#cmbCostRequestTypeSubDetail",
                "#cmbOriginProvinceId",
                "#cmbOriginCityId",
                "#cmbDestinationProvinceId",
                "#cmbDestinationCityId"
            ];
			
			//**************************************************************
			
			// وقتی Type عوض شد
			$("#cmbCostRequestTypeId").change(function() {
			    var selectedType = $(this).val();
			    $("#cmbCostRequestTypeDetailId option").hide();
			    $("#cmbCostRequestTypeDetailId option[value='']").show(); // placeholder
			    $("#cmbCostRequestTypeDetailId option[value='" + selectedType + "']").show();
			    $("#cmbCostRequestTypeDetailId").val("");
			    // ریست و مخفی SubDetail
			    $("#cmbCostRequestTypeSubDetail").val("");
			    $("#cmbCostRequestTypeSubDetail option").hide();
			    $("#cmbCostRequestTypeSubDetail option[value='']").show();
			});
			
			// وقتی Detail عوض شد
			$("#cmbCostRequestTypeDetailId").change(function() {
			    var selectedDetail = $("#cmbCostRequestTypeDetailId option:selected").attr("id");
			    $("#cmbCostRequestTypeSubDetail option").hide();
			    $("#cmbCostRequestTypeSubDetail option[value='']").show();
			    $("#cmbCostRequestTypeSubDetail option[value='" + selectedDetail + "']").show();
			    $("#cmbCostRequestTypeSubDetail").val("");
			});

			//*************************************************************
            // اعمال MutationObserver برای همه سلکتورها
            selectIds.forEach(observeAndAddPlaceholder);


            // ------------------ رویدادهای وابسته ------------------
            // استان و شهر پویا
            function handleProvinceChange(provinceSelector, citySelector) {
                $(provinceSelector).on('change', function () {
                    var selectedProvince = $(this).val();
                    var $citySelect = $(citySelector);
                    $citySelect.find('option').hide();
                    $citySelect.find('option').filter(function () {
                        return $(this).val() === selectedProvince;
                    }).show();
                    var firstVisible = $citySelect.find('option:visible:first').val();
                    $citySelect.val(firstVisible);
                });
            }




            $("#cmbCostRequestTypeId").trigger('change');

            // استان/شهر مبدا و مقصد واکنش‌گرا
            handleProvinceChange('#cmbOriginProvinceId', '#cmbOriginCityId');
            handleProvinceChange('#cmbDestinationProvinceId', '#cmbDestinationCityId');

            // سرویس کاربر فعلی
            UserService.GetCurrentUser(
                true,
                function (data) {
                    showLoading();
                    const xml = $.xmlDOM(data);
                    CurrentUserId = xml.find("user > id").text().trim();
                },
                function (err) {
                    console.log('Error callback fired');
                    hideLoading();
                    $ErrorHandling.Erro(err, "خطا در سرویس getCurrentActor");
                }
            );
        }

        // ======= Return Object ======
        return {
            init: init
        };
    })();

    $form.init();
});

Error On UserHelpes.readEmployeeInfo, [object Object]->Invalid column name 'EnabledActor'.

Form.+?rg=ZJM.PSE.PersonnelCredit&popupIndex=1&rv=-1:146 Details: Error Code : 46152
Error Message : 













            changeDialogTitle("ثبت جزییات اعلام هزینه");
			// Promise list
            const loadTasks = [
                loadComboboxData({
                    $element: $("#cmbCostRequestTypeId"),
                    readFunction: FormManager.costRequestTypeDetail,
                    idField: "Id",
                    textField: "ExpertFirstName",
                    textFormatter: (row) => `${row.ExpertFirstName} ${row.ExpertLastName}`
                }),
                loadComboboxData({
                    $element: $("#cmbCostRequestTypeDetailId"),
                    readFunction: FormManager.readBrand,
                    idField: "BrandRef",
                    textField: "BrandName"
                }),
                loadComboboxData({
                    $element: $("#cmbCostRequestTypeSubDetail"),
                    readFunction: FormManager.readBrand,
                    idField: "BrandRef",
                    textField: "BrandName"
                }),
                loadComboboxData({
                    $element: $("#cmbOriginProvinceId"),
                    readFunction: FormManager.readTypeName,
                    idField: "Id",
                    textField: "ProjectTypeName"
                }),
                loadComboboxData({
                    $element: $("#cmbOriginCityId"),
                    readFunction: FormManager.readProjectSubject,
                    idField: "Id",
                    textField: "ProjectSubjectName"
                }),
                loadComboboxData({
                    $element: $("#cmbDestinationProvinceId"),
                    readFunction: FormManager.readProjectTools,
                    idField: "Id",
                    textField: "ToolName"
                }),
                loadComboboxData({
                    $element: $("#cmbDestinationCityId"),
                    readFunction: FormManager.readProjectTools,
                    idField: "Id",
                    textField: "ToolName"
                })
            ];

            // When all Promise is done
            Promise.all(loadTasks)
                .then(() => {
                    hideLoading(); // Hide spinner of loading
                })
                .catch((err) => {
                    console.error("Error during ComboBox loading:", err);
                    hideLoading(); // Hide spinner of loading
                });
        












$('#tblCostRequest').on('click', 'a[id^="CR"]', function(e) {
		    e.preventDefault();
		    var $tr = $(this).closest('tr');
		    var costRequestId   = $tr.find('td').eq(1).text().trim();
		    var costRequestNo   = $tr.find('td').eq(2).text().trim();
		    var title           = $tr.find('td').eq(4).text().trim();
		
		    var params = {
		        CostRequestId: costRequestId,
		        CostRequestNo: costRequestNo,
		        Title: title
		    };
		    // نمایش مودال با پارامترهای مورد نیاز
		    $.showModalForm(
		        {
		            registerKey: "ZJM.RPC.CostInsert",
		            params: params
		        },
		        function(retVal) {
		            if (retVal.Result) {
		                tblCostRequest.refresh();
		            }
		        }
		    );
		});








CostRequestDetailCount
SumRequestCostPrice
SumConfirmCostPrice


if(rowInfo.ProcessStatus==1){
    tds.eq(2).html(`<a class="details-link" style="text-decoration: underline;" id=${rowInfo.CostRequestNo} href="#">${rowInfo.CostRequestNo}</a>`);
    }else{
        tds.eq(2).html(`<span>${rowInfo.CostRequestNo}</span>`);  // CostRequestNo
    }
























    				readFromData({Where: primaryKeyName + " = " + pk},
					function(dataXml)
					{

					}
				);


























                <dataset>
  <datatable>
    <row>
      <col name="Id">18</col>
      <col name="RequestCostId">86</col>
      <col name="CostDate">08/13/2025</col>->dpCostDate
      <col name="CostRequestTypeId">4</col>->cmbCostRequestTypeId
      <col name="CostRequestTypeName">سایر</col>->
      <col name="CostRequestTypeDetailId">13</col>->cmbCostRequestTypeDetailId
      <col name="CostRequestTypeDetailName">سایر</col>
      <col name="CostRequestTypeSubDetail"/>->cmbCostRequestTypeSubDetail
      <col name="CostRequestTypeSubDatailName"/>
      <col name="OriginProvinceId"/>->cmbOriginProvinceId
      <col name="OriginProvince"/>
      <col name="OriginCityId"/>->cmbOriginCityId
      <col name="OriginCity"/>
      <col name="StartDate"/>->dpStartDate
      <col name="StartKM"/>->txtStartKM
      <col name="DestinationProvinceId"/>->cmbDestinationProvinceId
      <col name="DestinationProvince"/>
      <col name="DestinationCityId"/>->cmbDestinationCityId
      <col name="DestinationCity"/>
      <col name="EndDate"/>->bpEndDate
      <col name="EndKM"/>->txtEndKM
      <col name="RequestCostPrice">90000</col>->txtRequestCostPrice
      <col name="ConfirmCostPrice"/>
      <col name="CreatedDate">07/30/2025 10:49:15</col>
    </row>
  </datatable>
</dataset>


$("#cmbCostRequestTypeId")
$("#cmbCostRequestTypeDetailId")
$("#cmbCostRequestTypeSubDetail")
$("#cmbOriginProvinceId")
$("#cmbOriginCityId")
$("#cmbDestinationProvinceId")
$("#cmbDestinationCityId")











/*
var params = window.dialogArguments || window.arguments || {};
// --- تبدیل XML به آبجکت JS ---
var dataXml = $(params); // params همون XMLDocument شما

// استخراج همه مقادیر مورد نیاز
var costDate                = dataXml.find("row:first > col[name='CostDate']").text();                  // dpCostDate
var costRequestTypeId       = dataXml.find("row:first > col[name='CostRequestTypeId']").text();         // cmbCostRequestTypeId
var costRequestTypeDetailId = dataXml.find("row:first > col[name='CostRequestTypeDetailId']").text();   // cmbCostRequestTypeDetailId
var costRequestTypeSubDetail= dataXml.find("row:first > col[name='CostRequestTypeSubDetail']").text();  // cmbCostRequestTypeSubDetail
var originProvinceId        = dataXml.find("row:first > col[name='OriginProvinceId']").text();          // cmbOriginProvinceId
var originCityId            = dataXml.find("row:first > col[name='OriginCityId']").text();              // cmbOriginCityId
var startDate               = dataXml.find("row:first > col[name='StartDate']").text();                 // dpStartDate
var startKM                 = dataXml.find("row:first > col[name='StartKM']").text();                   // txtStartKM
var destinationProvinceId   = dataXml.find("row:first > col[name='DestinationProvinceId']").text();     // cmbDestinationProvinceId
var destinationCityId       = dataXml.find("row:first > col[name='DestinationCityId']").text();         // cmbDestinationCityId
var endDate                 = dataXml.find("row:first > col[name='EndDate']").text();                   // bpEndDate
var endKM                   = dataXml.find("row:first > col[name='EndKM']").text();                     // txtEndKM
var requestCostPrice        = dataXml.find("row:first > col[name='RequestCostPrice']").text();          // txtRequestCostPrice

// ============================================
// ست کردن مقدارها به المنت‌های مربوطه
// (input ها، datepicker ها، select ها)

// تقویم‌ها یا inputهای تاریخ (مثلاً dpCostDate, dpStartDate, bpEndDate)
// مقدار inputها
$("#txtStartKM").val(startKM);
$("#txtEndKM").val(endKM);
$("#txtRequestCostPrice").val(requestCostPrice);
$("#txtConfirmPrice").val(confirmPrice);

// مقداردهی selectهای async-safe
$("#cmbCostRequestTypeId").val(costRequestTypeId);
$("#cmbCostRequestTypeDetailId").val(costRequestTypeDetailId);
$("#cmbCostRequestTypeSubDetail").val(costRequestTypeSubDetail);
$("#cmbOriginProvinceId").val(originProvinceId);
$("#cmbOriginCityId").val(originCityId);
$("#cmbDestinationProvinceId").val(destinationProvinceId);
$("#cmbDestinationCityId").val(destinationCityId);

// مقداردهی datepickerها به صورت مستقیم (در صورت داشتن setDate):
$("#dpCostDate").val(costDate);
$("#dpStartDate").val(startDate);
$("#bpEndDate").val(endDate);
*/

/// for insert to database
      IdeaNo->txtIdeaNo
      IdeaSubject->txtIdeaSubject
      FullDescription->txtFullDescription

      CreatorUserId-> txtCreatorUserId
      UserIdIdeas->txtUserIdIdeas
      RoleIdIdeas->txtRoleIdIdeas

      OtherInovations->txtOtherInovations
      OtherImprovement->txtchbOtherImprovement


      //checkbox1
      NewProduct->chbNewProduct
      ImprovementCurrentProducts->chbImprovementCurrentProducts

      //checkbox2
      BusinessModels->chbNewProduct
      OptimizationOfOrganization->chbOptimizationOfOrganization
      MotivatingEmployees->chbMotivatingEmployees
      FinancialStructue->chbFinancialStructue
      KnowledgeManagment->chbKnowledgeManagment
      InformationTechnology->chbInformationTechnology
      MarketingAndBranding->chbMarketingAndBranding
      InteractAndCommunicating->chbInteractAndCommunicating
      ImprovePerformance->chbImprovePerformance


      //checkbox3
      IncreaseIncome->chbIncreaseIncome
      IncreaseEffectiveness->chbIncreaseEffectiveness
      AccelerationOfProcesses->chbAccelerationOfProcesses
      FacilitateProcesses->chbFacilitateProcesses
      CreatingMotivationWorkplace->chbCreatingMotivationWorkplace
      PromoteEmployerBrand->chbPromoteEmployerBrand
      ReduceBusinessThreats->chbReduceBusinessThreats
      ReduceBusinessSafetyRisks->chbReduceBusinessSafetyRisks
      ReduceWaste->chbReduceWaste
      QualityImprovement->chbQualityImprovement
      ReducingFoodSafetyRisks->chbReducingFoodSafetyRisks


      //textbox  
      ResponsibleForImplementation->txtResponsibleForImplementation
      ReasonForResponsible->txtReasonForResponsible
      AdditionalInformation->txtOtherImprovement




      // آرایه‌هایی برای نگهداری همه UserId و RoleIdها (هر وقت رکوردی حذف شد، این‌ها رو هم آپدیت می‌کنیم!)
$("#btnAddIdeatorInfo").click(function(){
    var $combo = $("#cmbIdeatorInfo");
    var data = $combo.select2('data')[0]; // اطلاعات آیتم انتخاب شده
    if (!data) {
        alert('طرف رو انتخاب کن!');
        return;
    }

    // حالا اطلاعات رو بردار:
    var userId = data.userId || $combo.attr("data-userid") || '';
    var roleId = data.roleId || $combo.attr("data-roleid") || '';
    var fullName = data.text || '';

    // آرایه‌ها (اگر بار اول بود تعریف کن)
    window.selectedUserIds = window.selectedUserIds || [];
    window.selectedRoleIds = window.selectedRoleIds || [];

    // چک تکراری بودن
    if (selectedUserIds.indexOf(userId) !== -1) {
        alert('این قبلاً اضافه شده.');
        return;
    }

    // اضافه به آرایه و input‌ها
    selectedUserIds.push(userId);
    selectedRoleIds.push(roleId);
    $("#txtUserIdIdeas").val(selectedUserIds.join(","));
    $("#txtRoleIdIdeas").val(selectedRoleIds.join(","));

    // اضافه به جدول
    var $tr = $('<tr>'+
        '<td>'+fullName+'</td>'+
        '<td><span class="delete-ideator" style="color:red;cursor:pointer;">-</span></td>'+
    '</tr>');
    $("#tblIdeatorInfo tbody").append($tr);

    $tr.find(".delete-ideator").click(function(){
        var idx = selectedUserIds.indexOf(userId);
        if(idx !== -1){
            selectedUserIds.splice(idx, 1);
            selectedRoleIds.splice(idx, 1);
        }
        $("#txtUserIdIdeas").val(selectedUserIds.join(","));
        $("#txtRoleIdIdeas").val(selectedRoleIds.join(","));
        $tr.remove();
    });
});








function showAlertWithFocus(message, selectorToFocus) {
    $.alert({
        title: '',
        content: String(message), // 
        type: 'red',
        rtl: true,
        onClose: function () {
            if (selectorToFocus) {
                $(selectorToFocus).focus();
            }
        },
        buttons: {
            ok: {
                text: 'باشه',
                action: function () { /* هیچ کاری لازم نیست */ }
            }
        }
    });
}



insertFromData(params,
				function(dataXml)
				{
					pk = dataXml.find("row:first").find(">col[name='" + primaryKeyName + "']").text();
					
					inEditMode = true;
					var FormNewTitle= 'N\'درخواست وام (درخواست دهنده: '+ $("#txtFullName").val()+')\''
					WorkflowService.RunWorkflow("ZJM.LRP.LoanRequestProcess",
					    '<Content><Id>'+pk+'</Id><IsInTestMode>' + isInTestMode + '</IsInTestMode></Content>',
					    true,
					    function(data)
					    {		
					        $.alert("درخواست شما با موفقیت ارسال شد.","","rtl",function(){
								hideLoading();
					        	closeWindow({OK:true, Result:null});
							});				
					    }
					    ,function(err)
					    {
					        alert('مشکلی در شروع فرآیند به وجود آمده. '+err);
					        hideLoading();
					    }
					);
					myHideLoading();
					if($.isFunction(callback))
					{
						callback();
					}
				},
				function(err)
				{
					hideLoading();
					alert(err);
				}
			);








      IdeaSubject->txtIdeaSubject
      FullDescription->txtFullDescription



      //checkbox1
      NewProduct->chbNewProduct
      ImprovementCurrentProducts->chbImprovementCurrentProducts

      //checkbox2
      BusinessModels->chbNewProduct
      OptimizationOfOrganization->chbOptimizationOfOrganization
      MotivatingEmployees->chbMotivatingEmployees
      FinancialStructue->chbFinancialStructue
      KnowledgeManagment->chbKnowledgeManagment
      InformationTechnology->chbInformationTechnology
      MarketingAndBranding->chbMarketingAndBranding
      InteractAndCommunicating->chbInteractAndCommunicating
      ImprovePerformance->chbImprovePerformance
      OtherInovations->chbOtherInovations

      //checkbox3
      IncreaseIncome->chbIncreaseIncome
      IncreaseEffectiveness->chbIncreaseEffectiveness
      AccelerationOfProcesses->chbAccelerationOfProcesses
      FacilitateProcesses->chbFacilitateProcesses
      CreatingMotivationWorkplace->chbCreatingMotivationWorkplace
      PromoteEmployerBrand->chbPromoteEmployerBrand
      ReduceBusinessThreats->chbReduceBusinessThreats
      ReduceBusinessSafetyRisks->chbReduceBusinessSafetyRisks
      ReduceWaste->chbReduceWaste
      QualityImprovement->chbQualityImprovement
      ReducingFoodSafetyRisks->chbReducingFoodSafetyRisks
      OtherImprovement->chbOtherImprovement

      //textbox  
      ResponsibleForImplementation->txtResponsibleForImplementation
      ReasonForResponsible->txtReasonForResponsible
      AdditionalInformation->txtOtherImprovement



readFromData({ Where: primaryKeyName + " = " + pk }, function(dataXml) {
  const data = dataXml[0];

  const creatorUserId = data.CreatorUserId;
  const userIdIdeasList = (data.UserIdIdeas || "").split(',').map(id => id.trim()).filter(Boolean);
  const roleIdIdeasList = (data.RoleIdIdeas || "").split(',').map(id => id.trim()).filter(Boolean);

  console.log(" CreatorUserId:", creatorUserId);
  console.log(" UserIdIdeas:", userIdIdeasList);
  console.log(" RoleIdIdeas:", roleIdIdeasList);

  // حالا برای هر کاربر می‌ریم اطلاعات پرسنلی می‌گیریم
  const allUserIds = [...new Set([creatorUserId, ...userIdIdeasList])];

  allUserIds.forEach(userId => {
    const params = { Where: "ActorId = " + userId };
    BS_GetUserInfo.Read(params, function(data) {
      if ($.trim(data) !== "") {
        const dataXml = $.xmlDOM(data);
        const fullName = dataXml.find("row:first > col[name='fullName']").text();
        const UnitsName = dataXml.find("row:first > col[name='UnitsName']").text();
        const UserName = dataXml.find("row:first > col[name='UserName']").text();
        const userId = dataXml.find("row:first > col[name='UserId']").text();

        console.log(` User Info for ID ${userId}:`);
        console.log("   - FullName:", fullName);
        console.log("   - UnitsName:", UnitsName);
        console.log("   - UserName:", UserName);
      } else {
        console.warn(` No user data found for ActorId = ${userId}`);
      }
    });
  });
});
